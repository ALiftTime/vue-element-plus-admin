import{F as e}from"./Form.269be348.js";import{d as o,b as a,m as s,u as r,q as t,l as i,s as l,r as n,v as d,x as c,o as p,k as m,w as u,e as f,t as g,a as b,g as w,y as j}from"./index.f1ca6476.js";import{E as v}from"./el-button.9196e5a8.js";import{E as h}from"./tsxHelper.81087301.js";import{E as y}from"./el-link.c0549a94.js";import{u as x}from"./useForm.a8063ad0.js";import{l as P,g as R,a as _}from"./index.0bffbf78.js";import{u as I}from"./useValidator.78df2cde.js";import{_ as k}from"./plugin-vue_export-helper.21dcd24c.js";import"./el-col.c0721dc3.js";import"./typescript2.0a085a7f.js";import"./el-popper.26074e04.js";import"./index2.de1d094e.js";import"./el-input.6332a5d8.js";import"./event2.c09267d7.js";import"./index2.d5a2160b.js";import"./el-tag.fa9a0e84.js";import"./el-input-number.89257b62.js";import"./index2.0122a208.js";import"./el-switch.4a0f932e.js";import"./validator2.b2793d51.js";import"./el-divider.ebef0a45.js";import"./InputPassword.c58bf0cb.js";import"./Editor.29b98b5c.js";import"./debounce.d525c3c4.js";import"./aria2.dceaa135.js";import"./scroll2.632703f6.js";import"./browser2.cee2c328.js";const F={class:"text-2xl font-bold text-center w-[100%]"},z={class:"flex justify-between items-center w-[100%]"},E={class:"w-[100%]"},q={class:"w-[100%] mt-15px"},C={class:"flex justify-between w-[100%]"};var V=k(o({__name:"LoginForm",emits:["to-register"],setup(o,{emit:k}){const{required:V}=I(),D=a(),A=s(),{currentRoute:L,addRoute:U,push:H}=r(),{wsCache:N}=t(),{t:B}=i(),G={username:[V()],password:[V()]},J=l([{field:"title",colProps:{span:24}},{field:"username",label:B("login.username"),value:"admin",component:"Input",colProps:{span:24},componentProps:{placeholder:B("login.usernamePlaceholder")}},{field:"password",label:B("login.password"),value:"admin",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:B("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24}},{field:"login",colProps:{span:24}},{field:"other",component:"Divider",label:B("login.otherLogin"),componentProps:{contentPosition:"center"}},{field:"otherIcon",colProps:{span:24}}]),K=n(!1),{register:M,elFormRef:O,methods:Q}=x(),S=n(!1),T="#999",W=n("");d((()=>L.value),(e=>{var o;W.value=null==(o=null==e?void 0:e.query)?void 0:o.redirect}),{immediate:!0});const X=async()=>{const e=b(O);await(null==e?void 0:e.validate((async e=>{if(e){S.value=!0;const{getFormData:e}=Q,o=await e();try{const e=await P(o);e&&(N.set(D.getUserInfo,e.data),Y())}finally{S.value=!1}}})))},Y=async()=>{const{getFormData:e}=Q,o=await e(),a={roleName:o.username},s="admin"===o.username?await R(a):await _(a);if(s){const{wsCache:e}=t(),a=s.data||[];e.set("roleRouters",a),"admin"===o.username?await A.generateRoutes("admin",a).catch((()=>{})):await A.generateRoutes("test",a).catch((()=>{})),A.getAddRouters.forEach((e=>{U(e)})),A.setIsAddRouters(!0),H({path:W.value||A.addRouters[0].path})}},Z=()=>{k("to-register")};return(o,a)=>{const s=c("Icon");return p(),m(b(e),{schema:J,rules:G,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:b(M)},{title:u((()=>[f("h2",F,g(b(B)("login.login")),1)])),tool:u((()=>[f("div",z,[w(b(h),{modelValue:K.value,"onUpdate:modelValue":a[0]||(a[0]=e=>K.value=e),label:b(B)("login.remember"),size:"small"},null,8,["modelValue","label"]),w(b(y),{type:"primary",underline:!1},{default:u((()=>[j(g(b(B)("login.forgetPassword")),1)])),_:1})])])),login:u((()=>[f("div",E,[w(b(v),{loading:S.value,type:"primary",class:"w-[100%]",onClick:X},{default:u((()=>[j(g(b(B)("login.login")),1)])),_:1},8,["loading"])]),f("div",q,[w(b(v),{class:"w-[100%]",onClick:Z},{default:u((()=>[j(g(b(B)("login.register")),1)])),_:1})])])),otherIcon:u((()=>[f("div",C,[w(s,{icon:"ant-design:github-filled",size:30,class:"cursor-pointer anticon",color:T}),w(s,{icon:"ant-design:wechat-filled",size:30,class:"cursor-pointer anticon",color:T}),w(s,{icon:"ant-design:alipay-circle-filled",size:30,color:T,class:"cursor-pointer anticon"}),w(s,{icon:"ant-design:weibo-circle-filled",size:30,color:T,class:"cursor-pointer anticon"})])])),_:1},8,["schema","onRegister"])}}}),[["__scopeId","data-v-516888a6"]]);export{V as default};
